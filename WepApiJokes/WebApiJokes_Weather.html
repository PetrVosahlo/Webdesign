<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="bootstrap.min.css">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous" /> -->
  <link rel="stylesheet" href="css/custom.css" />
  <title>Jokes</title>
  <script language="JavaScript">
    //let ServerAdress = "https://localhost:44397";
    let ServerAdress = "http://petrv.somee.com";
    let town = "Hradec_Kralove";
    let country = "Czech_Republic"
    let jokeId = 1;
    let weather_code;
    let temperature;
    let wind_speed;
    function GetWeatherAndJokeForCity() {
      let townId;
      console.log("OK ");
      town = document.getElementById('selTown').value;
      let selTown = document.getElementById('selTown');
      townId = selTown.options[selTown.selectedIndex].getAttribute('townId');
      switch (townId) {
        case "Hk": document.getElementById('spanDescription').innerHTML = "<strong>Průměrná roční teplota 9, 2 °C.<br />Průměrné srážky za rok cca. 630 mm.</strong><br />Země: Česká republika, počet obyvatel: 92 763<br />"
          ; country = "Czech_Republic"; break;
        case "Pr": document.getElementById('spanDescription').innerHTML = "<strong>Průměrná roční teplota 10, 8 °C.<br />Průměrné srážky za rok cca. 500 mm.</strong > <br />Země: Česká republika, počet obyvatel: 1 275 406 <br />"
        ; country = "Czech_Republic"; break;
        case "Me": document.getElementById('spanDescription').innerHTML = "<strong>Město s jednou z nejvyšších průměrných teplot v Asii.<br />Průměrná roční teplota je kolem 29 °C (dle zdroje).</strong > <br />Země: Království Saúdská Arábie, počet obyvatel: 2 000 000"
        ; country = "Saudi_Arabia"; break;
        // case "Oj": document.getElementById('spanDescription').innerHTML = "<strong>Jendo z nejchladnějších trvale obydlených míst na zemi.<br /> Průměrná teplota za leden, únor a prosinec zůstává pod –40 °C.</strong > <br />Země: Ruská federace, počet obyvatel: 550"; country = "Russia"; break;
        case "Qu": document.getElementById('spanDescription').innerHTML = "<strong> Nejdeštivější město na světě.<br /> Průměrné srážky za rok jsou 7 000 mm - 8 000 mm (dle zdroje)</strong > <br />Země: Kolumbie, počet obyvatel: 129 237"; country = "Choco"; break;
        case "We": document.getElementById('spanDescription').innerHTML = "<strong>Největrnější město na světě.<br /> Průměrná rychlost větru za celý rok je 22 km/h a za září téměř 27 km/h.</strong > <br />Země: Nový Zéland, počet obyvatel: 180 000<br />"
        ; country = "New_Zealand"; break;
        case "Bo": document.getElementById('spanDescription').innerHTML = "<strong>Jedno z měst s nejvyšším výskytem bouřek na světě.<br />Město leží na úpatí sopky, na které bývá cca. 320 dní s bouřkou v roce.</strong > <br />Země: Indonésie, počet obyvatel: 1 091 396"; country = "Indonesia"; break;
      }

      const url = ServerAdress + '/weather/WeatherStack/' + town + ',%20' + country;
      SendGetRequest(url);
    }
    function TestWeatherAndJokeForCity() {
      settedWeather_code = document.getElementById("checkWeatherCode").value;
      const url = ServerAdress + '/weather/WeatherTest/' + settedWeather_code;
      SendGetRequest(url);
    }

    function SendGetRequest(url) {
      const Http = new XMLHttpRequest();
      Http.open("GET", url);
      Http.send();
      let retJSON;
      Http.onreadystatechange = (e) => {
        retJSON = Http.responseText;
        const obj = JSON.parse(retJSON);
        console.log(obj);
        weather_code = obj.weather_code;
        temperature = obj.temperature;
        wind_speed = obj.windSpeed;
        document.querySelector('[id="divPicture"]').innerHTML = '<img src="' + obj.pictureAddress + '" class="img-responsive rounded" temp="Weather picture" />';
        document.getElementById('description').innerText = obj.description;
        document.getElementById('temperature').innerText = temperature + " °C";
        document.getElementById('windSpeed').innerText = wind_speed + " km/h";
        document.getElementById('humidity').innerText = obj.humidity + " %";
        document.querySelector('[id="JokeText"]').innerText = obj.content;
        document.querySelector('[id="UserText"]').innerText = "Vtip vložil uživatel: Petr";
        jokeId = obj.id;
      }
    }

    function GetPreviousNextWeatherJoke(PrevNext) {
      const Http = new XMLHttpRequest();
      const url = ServerAdress + '/weather/WeatherStackPreviousNext/' + weather_code + ',%20' + temperature + ',%20' + wind_speed + ',%20' + jokeId + ',%20' + PrevNext;
      console.log(url);
      Http.open("GET", url);
      Http.send();
      let retJSON;
      Http.onreadystatechange = (e) => {
        retJSON = Http.responseText;
        const obj = JSON.parse(retJSON);
        console.log(obj)
        document.querySelector('[id="JokeText"]').innerText = obj.Content;
        document.querySelector('[id="UserText"]').innerText = "Vtip vložil uživatel: Petr";
        jokeId = obj.Id;
      }
    }
    window.onload = function () {
      GetWeatherAndJokeForCity();
    }
  </script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-light bg-white">
    <a href="WebApiJokes.html" class="navbar-brand">
      <h3 class="mb-0">Peter's jokes</h3>
    </a>

    <button class="navbar-toggler" data-toggle="collapse" data-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a href="WebApiJokes_Weather.html" class="nav-link">Počasí se vtipem</a>
        </li>
        <li class="nav-item">
          <a href="WebApiJokes_Insert.html" class="nav-link">Vložit vtip</a>
        </li>
        <li class="nav-item">
          <a href="WebApiJokes.html" class="nav-link">Číst vtipy</a>
        </li>
      </ul>
    </div>
  </nav>
  <section id="showcase">
    <div class="container p-1 p-sm-3">
      <div class="row justify-content-center">
        <div class="d-none d-sm-block h1 text-center">
          Náladu zlepší vtip hodící se k dnešnímu počasí.
        </div>
        <div class="d-sm-none h5 text-center bg-light p-1">
          Náladu zlepší vtip hodící se k dnešnímu počasí.
        </div>
      </div>
      <form class="form-inline col-12 my-2" name="Joke" action="">
        <!-- <div class="form-inline"> -->
        <div class="form-inline col-12 col-sm-4 col-md-3 col-xl-4 justify-content-center justify-content-xl-end p-0">
          <label for="selTown" class="col-6 col-sm-5 col-xl-2 control-label text-center bg-white rounded p-1">
            Město</label>
          <select class="col-12 col-lg-9 col-xl-6 text-center form-control ml-sm-1 my-2" name="User"
            id="selTown" onchange="GetWeatherAndJokeForCity()">
            <option value="Hradec_Kralove" townId="Hk">Hradec Králové</option>
            <option value="Praha" townId="Pr">Praha</option>
            <option value="Mecca" townId="Me">Mekka</option>
            <!-- <option value="Ojmjakon" townId="Oj">Ojmjakon</option> -->
            <option value="Quibdó" townId="Qu">Quibdó</option>
            <option value="Wellington" townId="We">Wellington</option>
            <option value="Bogor" townId="Bo">Bogor</option>
          </select>
        </div>
        <div class="col-sm-7 col-md-4 col-md-8 col-xl-7 text-center text-md-left bg-white rounded p-1 pl-lg-3 ml-sm-4 mt-2 mt-sm-0">
          <span id="spanDescription">TEXT GENERATED BY GetWeatherAndJokeForCity()</span>
        </div>
      </form>
    </div>
    <div class="container">
      <div class="row">
        <div id="divPicture" class="col-sm-5 col-lg-4 col-xl-3 offset-lg-1 border-light my-auto">
          <!-- <img id="PictureAddress" src="./images/113_Sunny.jpg" class="img-responsive rounded" temp="Weather picture" /> -->
        </div>
        <div class="col-sm-7 col-lg-6 col-xl-7 text-right my-auto">
          <div class="row my-sm-1 my-1 my-md-2 my-lg-3">
            <div class="col-12 col-sm-4 col-xl-3 rounded align-self-center text-left text-sm-right bg-light">
              Popis:
            </div>
            <div id="description" class="col-12 col-sm-8 col-xl-9 align-self-center rounded text-left bg-white">
            </div>
          </div>
          <div class="row my-sm-1 my-1 my-md-2 my-lg-3">
            <div class="col-12 col-sm-4 col-xl-3 rounded text-left text-sm-right bg-light">
              Teplota:
            </div>
            <div id="temperature"
              class="col-12 col-sm-8 col-xl-9 align-self-center rounded text-center text-sm-left bg-white">
            </div>
          </div>
          <div class="row my-sm-1 my-1 my-md-2 my-lg-3">
            <div class="col-12 col-sm-4 col-xl-3 rounded text-left text-sm-right bg-light">
              Rychlost větru:
            </div>
            <div id="windSpeed"
              class="col-12 col-sm-8 col-xl-9 align-self-center rounded text-center text-sm-left bg-white">
            </div>
          </div>
          <div class="row my-sm-1 my-1 my-md-2 my-lg-3">
            <div class="col-12 col-sm-4 col-xl-3 rounded text-left text-sm-right bg-light">
              Vlhkost:
            </div>
            <div id="humidity"
              class="col-12 col-sm-8 col-xl-9 align-self-center rounded text-center text-sm-left bg-white">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="row">
      <label for="checkWeatherCode">Zadej WeathereCode: </label>
      <input type="text" id="checkWeatherCode" placeholder="weatherCode" />
      <button onclick="TestWeatherAndJokeForCity()">Test</buton>
    </div> -->
    <div class="container">
      <div class="form-group mt-4">
        <div class="row d-flex justify-content-around my-3">
          <div class="col-12 col-sm-4 col-lg-3 col-xl-2 my-1 my-sm-0">
            <button class="btn-lg btn-block btn-success"
              onclick="GetPreviousNextWeatherJoke('false')">Předchozí</button>
          </div>
          <div class="col-12 col-sm-4 col-lg-3 col-xl-2">
            <button class="btn-lg btn-block btn-success"
              onclick="GetPreviousNextWeatherJoke('true')">Následující</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 col-lg-10 offset-lg-1 pl-3">
            <h3 class="bg-success text-white rounded p-1" id="JokeText"></h3>
            <div class="col-sm-8 col-md-6 col-lg-5 col-xl-4 p-0 text-center">
              <h5 class="bg-primary text-white rounded" id="UserText"></h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll@15/dist/smooth-scroll.polyfills.min.js"></script>

  <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="bootstrap/dist/js/bootstrap.min.js"></script> -->

  <script src="kolosalon.js"></script>

  <script type="text/javascript">
    $(function () {
      var scroll = new SmoothScroll('a[href*="section-"]');
    });
    $(document).ready(function () {
      $(".navbar-nav li a").click(function (event) {
        $(".navbar-collapse").collapse('hide');
      });
    });
  </script>
</body>

</html>